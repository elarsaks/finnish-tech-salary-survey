name: Deploy to Kaggle

on:
  push:
    branches: [master]
    paths:
      - "data/*.ipynb"
      - "data/.kaggle/**"
  workflow_dispatch:  # Manual trigger from GitHub UI

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Kaggle CLI
        run: pip install kaggle

      - name: Configure Kaggle credentials
        run: |
          mkdir -p ~/.kaggle
          echo '{"username":"${{ secrets.KAGGLE_USERNAME }}","key":"${{ secrets.KAGGLE_KEY }}"}' > ~/.kaggle/kaggle.json
          chmod 600 ~/.kaggle/kaggle.json

      - name: Prepare and deploy Data Download notebook
        run: |
          mkdir -p /tmp/kaggle-download
          cp data/.kaggle/download-kernel-metadata.json /tmp/kaggle-download/kernel-metadata.json
          cp data/finnish-tech-salary-survey-2024-data-download.ipynb /tmp/kaggle-download/
          kaggle kernels push -p /tmp/kaggle-download

      - name: Prepare and deploy Data Cleaning notebook
        run: |
          mkdir -p /tmp/kaggle-cleaning
          cp data/.kaggle/cleaning-kernel-metadata.json /tmp/kaggle-cleaning/kernel-metadata.json
          cp data/finnish-tech-salary-survey-2024-data-cleaning.ipynb /tmp/kaggle-cleaning/
          kaggle kernels push -p /tmp/kaggle-cleaning
